<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠØ©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0d47a1 0%, #1a237e 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            position: relative;
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #e3f2fd, #bbdefb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header .subtitle {
            font-size: 16px;
            color: #b0b0b0;
            margin-bottom: 20px;
        }
        
        /* ØªØ¨Ø§Ø¯Ù„ Ø§Ù„ØµÙØ­Ø§Øª */
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ */
        .nav-tabs {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 8px;
        }
        
        .tab-btn {
            padding: 14px 10px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 500;
        }
        
        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #5c6bc0 0%, #3949ab 100%);
            font-weight: bold;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(92, 107, 192, 0.3);
        }
        
        /* Ø¨Ø·Ø§Ù‚Ø§Øª */
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .card h2 {
            font-size: 22px;
            margin-bottom: 20px;
            color: #e0e0e0;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Ù†Ù…Ø§Ø°Ø¬ */
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-size: 16px;
            color: #e0e0e0;
            font-weight: 500;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 16px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #5c6bc0;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 3px rgba(92, 107, 192, 0.2);
        }
        
        input::placeholder {
            color: #b0b0b0;
        }
        
        /* Ø£Ø²Ø±Ø§Ø± */
        .btn {
            padding: 16px 30px;
            background: linear-gradient(135deg, #5c6bc0 0%, #3949ab 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #43a047 0%, #2e7d32 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e53935 0%, #c62828 100%);
        }
        
        .btn-small {
            padding: 10px 20px;
            font-size: 14px;
        }
        
        .btn-full {
            width: 100%;
            margin: 15px 0;
        }
        
        /* ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ */
        .code-generator {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            align-items: center;
        }
        
        .code-display {
            flex: 1;
            background: rgba(255, 255, 255, 0.15);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 18px;
            text-align: center;
            font-size: 26px;
            font-weight: bold;
            letter-spacing: 3px;
            color: #4caf50;
            font-family: 'Courier New', monospace;
        }
        
        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ */
        .students-list {
            margin-top: 25px;
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .student-item {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .student-item:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateX(-5px);
            border-color: rgba(92, 107, 192, 0.5);
        }
        
        .student-item.selected {
            background: rgba(92, 107, 192, 0.2);
            border-color: #5c6bc0;
            transform: translateX(-8px);
        }
        
        .student-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .student-name {
            font-size: 19px;
            font-weight: bold;
            color: #bbdefb;
        }
        
        .student-code {
            background: rgba(76, 175, 80, 0.2);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 15px;
            color: #c8e6c9;
            font-family: 'Courier New', monospace;
        }
        
        .student-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            font-size: 15px;
            color: #b0b0b0;
        }
        
        .student-info span {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 6px;
            text-align: center;
        }
        
        /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨ */
        .student-edit-form {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .grades-container {
            margin-top: 20px;
        }
        
        .grade-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        /* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 25px 0;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #4caf50;
            margin: 15px 0;
        }
        
        .stat-label {
            font-size: 15px;
            color: #b0b0b0;
        }
        
        /* ÙØµÙˆÙ„ */
        .class-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }
        
        .class-btn {
            padding: 18px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .class-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        .class-btn.selected {
            background: linear-gradient(135deg, #5c6bc0 0%, #3949ab 100%);
            border-color: #5c6bc0;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(92, 107, 192, 0.3);
        }
        
        /* Ø£Ø®Ø¨Ø§Ø± Ø§Ù„ÙØµÙˆÙ„ */
        .class-news-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        /* Ø±Ø³Ø§Ø¦Ù„ */
        .message {
            padding: 18px;
            border-radius: 12px;
            margin-bottom: 25px;
            text-align: center;
            display: none;
            animation: slideIn 0.3s ease;
            border: 1px solid;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .error {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.2), rgba(211, 47, 47, 0.2));
            border-color: #f44336;
            color: #ffcdd2;
        }
        
        .success {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(56, 142, 60, 0.2));
            border-color: #4caf50;
            color: #c8e6c9;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 25px 0;
        }
        
        .loading span {
            display: inline-block;
            width: 22px;
            height: 22px;
            margin: 0 8px;
            background: #5c6bc0;
            border-radius: 50%;
            animation: loading 1.4s infinite ease-in-out both;
        }
        
        .loading span:nth-child(1) { animation-delay: -0.32s; }
        .loading span:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes loading {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
        
        /* ØªØ°ÙŠÙŠÙ„ */
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 14px;
            color: #b0b0b0;
        }
        
        @media (max-width: 768px) {
            .nav-tabs {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .student-info {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .code-generator {
                flex-direction: column;
            }
            
            .class-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠØ©</h1>
            <div class="subtitle">Ø£/ Ø§Ø³Ù…Ø§Ø¹ÙŠÙ„ Ø¹Ù…Ø§Ø¯ - Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</div>
        </div>
        
        <div class="nav-tabs">
            <button class="tab-btn active" data-page="addStudent">Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</button>
            <button class="tab-btn" data-page="classControl">Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ÙØµÙˆÙ„</button>
            <button class="tab-btn" data-page="editStudent">ØªØ¹Ø¯ÙŠÙ„ Ø·Ø§Ù„Ø¨</button>
            <button class="tab-btn" data-page="stats">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
        </div>
        
        <div class="message" id="message"></div>
        <div class="loading" id="loading">
            <span></span>
            <span></span>
            <span></span>
        </div>
        
        <!-- ØµÙØ­Ø© Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ -->
        <div class="page active" id="addStudentPage">
            <div class="card">
                <h2>Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
                
                <div class="form-group">
                    <label for="studentName">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</label>
                    <input type="text" id="studentName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ÙƒØ§Ù…Ù„">
                </div>
                
                <div class="form-group">
                    <label for="studentPhone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input type="tel" id="studentPhone" placeholder="01xxxxxxxxx">
                </div>
                
                <div class="form-group">
                    <label>Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label>
                    <div class="class-options">
                        <div class="class-btn" data-class="1/4">Ø§Ù„ÙØµÙ„ 1/4</div>
                        <div class="class-btn" data-class="2/4">Ø§Ù„ÙØµÙ„ 2/4</div>
                        <div class="class-btn" data-class="3/4">Ø§Ù„ÙØµÙ„ 3/4</div>
                        <div class="class-btn" data-class="4/4">Ø§Ù„ÙØµÙ„ 4/4</div>
                        <div class="class-btn" data-class="3/1">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</div>
                    </div>
                    <input type="hidden" id="selectedClass">
                </div>
                
                <div class="form-group">
                    <label>Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label>
                    <div class="class-options">
                        <div class="class-btn" data-months="1">Ø´Ù‡Ø± ÙˆØ§Ø­Ø¯ - 60 Ø¬</div>
                        <div class="class-btn" data-months="2">Ø´Ù‡Ø±ÙŠÙ† - 100 Ø¬</div>
                        <div class="class-btn" data-months="3">3 Ø´Ù‡ÙˆØ± - 140 Ø¬</div>
                    </div>
                    <input type="hidden" id="selectedMonths">
                </div>
                
                <div class="form-group">
                    <label>ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„</label>
                    <div class="code-generator">
                        <div class="code-display" id="generatedCode">00000000</div>
                        <button class="btn" id="generateCodeBtn">ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯</button>
                    </div>
                </div>
                
                <button class="btn btn-full" id="addStudentBtn">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨</button>
            </div>
            
            <div class="card">
                <h2>Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¶Ø§ÙÙŠÙ†</h2>
                <div class="students-list" id="studentsList">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                </div>
            </div>
        </div>
        
        <!-- ØµÙØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ÙØµÙˆÙ„ -->
        <div class="page" id="classControlPage">
            <div class="card">
                <h2>Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø£Ø®Ø¨Ø§Ø± Ø§Ù„ÙØµÙˆÙ„ ÙˆØ§Ù„Ù…Ø¯Ø±Ø³Ø©</h2>
                
                <div class="form-group">
                    <label>Ø§Ø®ØªØ± Ø§Ù„ÙØµÙ„</label>
                    <div class="class-options">
                        <div class="class-btn class-selector" data-class="1/4">Ø§Ù„ÙØµÙ„ 1/4</div>
                        <div class="class-btn class-selector" data-class="2/4">Ø§Ù„ÙØµÙ„ 2/4</div>
                        <div class="class-btn class-selector" data-class="3/4">Ø§Ù„ÙØµÙ„ 3/4</div>
                        <div class="class-btn class-selector" data-class="4/4">Ø§Ù„ÙØµÙ„ 4/4</div>
                        <div class="class-btn class-selector" data-class="3/1">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</div>
                        <div class="class-btn class-selector" data-class="school">Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</div>
                    </div>
                </div>
                
                <div id="currentClassInfo" style="margin-bottom: 25px; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 10px; display: none;">
                    <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØµÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
                    <div id="classInfoDisplay"></div>
                </div>
                
                <div class="form-group">
                    <label for="classNews">Ø£Ø®Ø¨Ø§Ø± Ø§Ù„ÙØµÙ„/Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</label>
                    <textarea id="classNews" placeholder="Ø§ÙƒØªØ¨ Ø£Ø®Ø¨Ø§Ø± Ø§Ù„ÙØµÙ„ Ø£Ùˆ Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ù‡Ù†Ø§..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="classHomework">ÙˆØ§Ø¬Ø¨ Ø§Ù„ÙØµÙ„</label>
                    <textarea id="classHomework" placeholder="Ø§ÙƒØªØ¨ ÙˆØ§Ø¬Ø¨ Ø§Ù„ÙØµÙ„ Ù‡Ù†Ø§..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="groupHomework">ÙˆØ§Ø¬Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</label>
                    <div class="form-row">
                        <input type="text" id="saturdayGroup" placeholder="ÙˆØ§Ø¬Ø¨ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø³Ø¨Øª">
                        <input type="text" id="tuesdayGroup" placeholder="ÙˆØ§Ø¬Ø¨ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡">
                        <input type="text" id="thursdayGroup" placeholder="ÙˆØ§Ø¬Ø¨ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø®Ù…ÙŠØ³">
                    </div>
                </div>
                
                <button class="btn btn-full btn-secondary" id="saveClassInfoBtn">Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØµÙ„</button>
            </div>
        </div>
        
        <!-- ØµÙØ­Ø© ØªØ¹Ø¯ÙŠÙ„ Ø·Ø§Ù„Ø¨ -->
        <div class="page" id="editStudentPage">
            <div class="card">
                <h2>ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ…Ø³ØªÙˆÙ‰ Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
                
                <div class="form-group">
                    <label for="searchStudent">Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø·Ø§Ù„Ø¨</label>
                    <input type="text" id="searchStudent" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„ÙƒÙˆØ¯ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ...">
                    <div style="margin-top: 10px; font-size: 14px; color: #b0b0b0;">
                        Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø·Ø§Ù„Ø¨ØŒ Ø«Ù… Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡
                    </div>
                </div>
                
                <div id="searchResults" class="students-list"></div>
                
                <div id="studentEditForm" style="display: none;">
                    <div class="student-edit-form">
                        <h3 id="editingStudentName"></h3>
                        <div class="student-info" id="editingStudentInfo" style="margin-bottom: 20px;"></div>
                        
                        <div class="form-group">
                            <label>Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</label>
                            <div class="form-row">
                                <input type="text" id="gradeTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø¬Ø© (Ù…Ø«Ù„: Ø§Ø®ØªØ¨Ø§Ø± Ø´Ù‡Ø± Ù†ÙˆÙÙ…Ø¨Ø±)">
                                <input type="number" id="gradeValue" placeholder="Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¯Ø±Ø¬Ø© (Ù…Ù† 100)">
                            </div>
                            <button class="btn btn-small" id="addGradeBtn">Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø¬Ø©</button>
                            <div class="grades-container" id="gradesList"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="studentLevel">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆÙ†ØµØ§Ø¦Ø­ Ø§Ù„Ø§Ø³ØªØ§Ø°</label>
                            <textarea id="studentLevel" placeholder="Ø§ÙƒØªØ¨ ØªÙ‚ÙŠÙŠÙ… Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ§Ù„Ù†ØµØ§Ø¦Ø­..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="studentBehavior">Ø³Ù„ÙˆÙƒ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆÙ†ØµØ§Ø¦Ø­ Ù„Ù„ØªØ¹Ø§Ù…Ù„</label>
                            <textarea id="studentBehavior" placeholder="Ø§ÙƒØªØ¨ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³Ù„ÙˆÙƒ ÙˆØ§Ù„Ù†ØµØ§Ø¦Ø­..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="studentHomeworkStatus">Ø­Ø§Ù„Ø© Ø§Ù„ÙˆØ§Ø¬Ø¨ (Ø®Ø§Øµ Ø¨Ø§Ù„Ø·Ø§Ù„Ø¨)</label>
                            <select id="studentHomeworkStatus">
                                <option value="">Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø§Ù„ÙˆØ§Ø¬Ø¨</option>
                                <option value="Ù…Ù…ØªØ§Ø²">Ù…Ù…ØªØ§Ø² - ÙŠÙ†Ø¬Ø² Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</option>
                                <option value="Ø¬ÙŠØ¯">Ø¬ÙŠØ¯ - ÙŠÙ†Ø¬Ø² Ù…Ø¹Ø¸Ù… Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</option>
                                <option value="Ù…ØªÙˆØ³Ø·">Ù…ØªÙˆØ³Ø· - ÙŠØ­ØªØ§Ø¬ Ù…ØªØ§Ø¨Ø¹Ø©</option>
                                <option value="Ø¶Ø¹ÙŠÙ">Ø¶Ø¹ÙŠÙ - ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†</option>
                            </select>
                        </div>
                        
                        <div class="form-row">
                            <button class="btn btn-secondary btn-full" id="saveStudentInfoBtn">Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</button>
                            <button class="btn btn-danger btn-full" id="deleteStudentBtn">Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ØµÙØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div class="page" id="statsPage">
            <div class="card">
                <h2>Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</div>
                        <div class="stat-value" id="totalStudents">0</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">Ø·Ù„Ø§Ø¨ Ù†Ø´Ø·ÙŠÙ†</div>
                        <div class="stat-value" id="activeStudents">0</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">Ø·Ù„Ø§Ø¨ Ø¹Ù„Ù‰ ÙˆØ´Ùƒ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</div>
                        <div class="stat-value" id="expiringStudents">0</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</div>
                        <div class="stat-value" id="totalRevenue">0 Ø¬</div>
                    </div>
                </div>
                
                <div class="card" style="margin-top: 25px;">
                    <h3>Ø·Ù„Ø§Ø¨ Ø¹Ù„Ù‰ ÙˆØ´Ùƒ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (Ø£Ù‚Ù„ Ù…Ù† 3 Ø£ÙŠØ§Ù…)</h3>
                    <div id="expiringSoonList" class="students-list"></div>
                </div>
                
                <div class="card">
                    <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                    <div class="form-group">
                        <button class="btn btn-danger btn-full" id="deactivateExpiredBtn">ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ø´ØªØ±Ø§ÙƒØ§ØªÙ‡Ù…</button>
                        <div style="margin-top: 10px; font-size: 14px; color: #b0b0b0;">
                            Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø³ÙŠØ¹Ø·Ù„ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ø´ØªØ±Ø§ÙƒØ§ØªÙ‡Ù… ÙÙ‚Ø· ÙˆÙ„Ù† ÙŠØ­Ø°ÙÙ‡Ù…
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <button class="btn btn-full" id="exportDataBtn">ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                    </div>
                    
                    <div class="form-group">
                        <button class="btn btn-danger btn-full" id="deleteExpiredBtn" style="background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);">
                            âš ï¸ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ø´ØªØ±Ø§ÙƒØ§ØªÙ‡Ù… Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹
                        </button>
                        <div style="margin-top: 10px; font-size: 14px; color: #ffcdd2;">
                            ØªØ­Ø°ÙŠØ±: Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø³ÙŠÙ‚ÙˆÙ… Ø¨Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ø´ØªØ±Ø§ÙƒØ§ØªÙ‡Ù… Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            Â© 2026 Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠØ© - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            getDocs, 
            query, 
            where, 
            doc, 
            setDoc, 
            updateDoc, 
            deleteDoc,
            getDoc,
            serverTimestamp,
            orderBy,
            limit
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDFO3F3E4vie6WA8fCA00rmRp_0_2CPq5I",
            authDomain: "exam-1fd4a.firebaseapp.com",
            projectId: "exam-1fd4a",
            storageBucket: "exam-1fd4a.firebasestorage.app",
            messagingSenderId: "861838351458",
            appId: "1:861838351458:web:58087fe82ad951b9bac53b",
            measurementId: "G-Q05JBNZJ3V"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Ø§Ù„ÙƒÙˆÙ„ÙŠÙƒØ´Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
        const COLLECTIONS = {
            STUDENTS: 'students',
            ACTIVE_SUBSCRIPTIONS: 'active_subscriptions',
            CLASS_INFO: 'class_information',
            STUDENT_DATA: 'student_data',
            STUDENT_GRADES: 'student_grades'
        };

        // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let currentEditingStudent = null;
        let currentStudentData = null;
        let selectedClassForNews = null;

        // DOM Elements
        const message = document.getElementById('message');
        const loading = document.getElementById('loading');
        const pages = document.querySelectorAll('.page');
        const tabBtns = document.querySelectorAll('.tab-btn');

        // ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ 8 Ø£Ø±Ù‚Ø§Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
        function generateRandomCode() {
            return Math.floor(10000000 + Math.random() * 90000000).toString();
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙˆØ¯
        document.getElementById('generateCodeBtn').addEventListener('click', () => {
            document.getElementById('generatedCode').textContent = generateRandomCode();
        });

        // ØªÙ‡ÙŠØ¦Ø© ÙƒÙˆØ¯ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        document.getElementById('generatedCode').textContent = generateRandomCode();

        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØµÙ„ (Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨)
        document.querySelectorAll('.class-btn[data-class]').forEach(btn => {
            if (!btn.classList.contains('class-selector')) {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.class-btn[data-class]').forEach(b => {
                        b.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    document.getElementById('selectedClass').value = this.dataset.class;
                });
            }
        });

        // Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
        document.querySelectorAll('.class-btn[data-months]').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.class-btn[data-months]').forEach(b => {
                    b.classList.remove('selected');
                });
                this.classList.add('selected');
                document.getElementById('selectedMonths').value = this.dataset.months;
            });
        });

        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØµÙ„ (Ù„Ù„Ø£Ø®Ø¨Ø§Ø±)
        document.querySelectorAll('.class-selector').forEach(btn => {
            btn.addEventListener('click', async function() {
                document.querySelectorAll('.class-selector').forEach(b => {
                    b.classList.remove('selected');
                });
                this.classList.add('selected');
                selectedClassForNews = this.dataset.class;
                await loadClassInfo(selectedClassForNews);
            });
        });

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØµÙØ­Ø§Øª
        tabBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const pageId = this.dataset.page;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ø´Ø·Ø©
                tabBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                pages.forEach(page => {
                    page.classList.remove('active');
                    if (page.id === pageId + 'Page') {
                        page.classList.add('active');
                        
                        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù„Ù„ØµÙØ­Ø§Øª
                        if (pageId === 'addStudent') {
                            loadStudents();
                        }
                        if (pageId === 'stats') {
                            loadStatistics();
                        }
                        if (pageId === 'classControl') {
                            // Ø§Ø®ØªÙŠØ§Ø± Ø£ÙˆÙ„ ÙØµÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
                            const firstClassBtn = document.querySelector('.class-selector');
                            if (firstClassBtn && !selectedClassForNews) {
                                firstClassBtn.click();
                            }
                        }
                    }
                });
            });
        });

        // Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
        document.getElementById('addStudentBtn').addEventListener('click', async () => {
            const studentName = document.getElementById('studentName').value;
            const studentPhone = document.getElementById('studentPhone').value;
            const selectedClass = document.getElementById('selectedClass').value;
            const selectedMonths = document.getElementById('selectedMonths').value;
            const generatedCode = document.getElementById('generatedCode').textContent;
            
            if (!studentName || !studentPhone || !selectedClass || !selectedMonths) {
                showMessage('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                // Ø­Ø³Ø§Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
                const endDate = new Date();
                endDate.setMonth(endDate.getMonth() + parseInt(selectedMonths));
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø©
                const price = selectedMonths === '1' ? 60 : selectedMonths === '2' ? 100 : 140;
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙˆØ¯ Ø¥Ù„Ù‰ active_subscriptions
                const subscriptionData = {
                    code: generatedCode,
                    used: false,
                    months: parseInt(selectedMonths),
                    price: price,
                    createdAt: new Date().toISOString(),
                    createdBy: 'dashboard'
                };
                
                await addDoc(collection(db, COLLECTIONS.ACTIVE_SUBSCRIPTIONS), subscriptionData);
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¥Ù„Ù‰ students collection
                const studentData = {
                    name: studentName,
                    phone: studentPhone,
                    class: selectedClass,
                    code: generatedCode,
                    months: parseInt(selectedMonths),
                    startDate: new Date().toISOString(),
                    endDate: endDate.toISOString(),
                    active: true,
                    createdAt: new Date().toISOString(),
                    subscriptionPrice: price,
                    createdBy: 'dashboard'
                };
                
                const studentDocRef = await addDoc(collection(db, COLLECTIONS.STUDENTS), studentData);
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø·Ø§Ù„Ø¨ ÙÙŠ student_data
                const studentInfoData = {
                    studentId: studentDocRef.id,
                    studentName: studentName,
                    studentPhone: studentPhone,
                    studentClass: selectedClass,
                    level: '',
                    behavior: '',
                    homeworkStatus: '',
                    grades: [],
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                await addDoc(collection(db, COLLECTIONS.STUDENT_DATA), studentInfoData);
                
                showMessage(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ ${studentName} Ø¨Ù†Ø¬Ø§Ø­ ÙˆØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ ${generatedCode}`, 'success');
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                document.getElementById('studentName').value = '';
                document.getElementById('studentPhone').value = '';
                document.querySelectorAll('.class-btn').forEach(b => b.classList.remove('selected'));
                document.getElementById('generatedCode').textContent = generateRandomCode();
                
                // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨
                await loadStudents();
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨:', error);
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨', 'error');
            } finally {
                showLoading(false);
            }
        });

        // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨
        async function loadStudents() {
            try {
                showLoading(true);
                const q = query(collection(db, COLLECTIONS.STUDENTS), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(q);
                const studentsList = document.getElementById('studentsList');
                studentsList.innerHTML = '';
                
                if (querySnapshot.empty) {
                    studentsList.innerHTML = '<div style="text-align: center; padding: 40px; color: #b0b0b0;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù…Ø¶Ø§ÙÙŠÙ† Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</div>';
                    showLoading(false);
                    return;
                }
                
                querySnapshot.forEach(doc => {
                    const student = doc.data();
                    const studentItem = createStudentItem(doc.id, student);
                    studentsList.appendChild(studentItem);
                });
                
                showLoading(false);
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨:', error);
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨', 'error');
                showLoading(false);
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø·Ø§Ù„Ø¨
        function createStudentItem(id, student) {
            const studentItem = document.createElement('div');
            studentItem.className = 'student-item';
            studentItem.dataset.id = id;
            
            const endDate = new Date(student.endDate);
            const daysLeft = Math.ceil((endDate - new Date()) / (1000 * 60 * 60 * 24));
            const status = student.active ? (daysLeft > 0 ? 'Ù†Ø´Ø·' : 'Ù…Ù†ØªÙ‡ÙŠ') : 'Ù…Ø¹Ø·Ù„';
            const statusColor = student.active ? (daysLeft > 0 ? '#4caf50' : '#ff9800') : '#f44336';
            
            studentItem.innerHTML = `
                <div class="student-header">
                    <div class="student-name">${student.name}</div>
                    <div class="student-code">${student.code}</div>
                </div>
                <div class="student-info">
                    <span style="color: ${statusColor}">${status}</span>
                    <span>${student.class}</span>
                    <span>${daysLeft > 0 ? `${daysLeft} ÙŠÙˆÙ…` : 'Ù…Ù†ØªÙ‡ÙŠ'}</span>
                </div>
                <div style="margin-top: 10px; font-size: 14px; color: #b0b0b0;">
                    Ø§Ù„Ù‡Ø§ØªÙ: ${student.phone}
                </div>
            `;
            
            studentItem.addEventListener('click', () => {
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ±
                document.querySelectorAll('.student-item').forEach(item => {
                    item.classList.remove('selected');
                });
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù„Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø­Ø§Ù„ÙŠ
                studentItem.classList.add('selected');
                // ØªØ­Ø±ÙŠØ± Ø§Ù„Ø·Ø§Ù„Ø¨
                editStudent(id, student);
            });
            
            return studentItem;
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        async function loadStatistics() {
            try {
                showLoading(true);
                const studentsSnapshot = await getDocs(collection(db, COLLECTIONS.STUDENTS));
                let totalRevenue = 0;
                let activeCount = 0;
                let expiringCount = 0;
                const expiringSoon = [];
                
                studentsSnapshot.forEach(doc => {
                    const student = doc.data();
                    totalRevenue += student.subscriptionPrice || 0;
                    
                    if (student.active) {
                        activeCount++;
                        
                        const endDate = new Date(student.endDate);
                        const daysLeft = Math.ceil((endDate - new Date()) / (1000 * 60 * 60 * 24));
                        
                        if (daysLeft <= 3 && daysLeft > 0) {
                            expiringCount++;
                            expiringSoon.push({
                                id: doc.id,
                                name: student.name,
                                daysLeft: daysLeft,
                                class: student.class,
                                phone: student.phone
                            });
                        }
                    }
                });
                
                document.getElementById('totalStudents').textContent = studentsSnapshot.size;
                document.getElementById('activeStudents').textContent = activeCount;
                document.getElementById('expiringStudents').textContent = expiringCount;
                document.getElementById('totalRevenue').textContent = totalRevenue + ' Ø¬';
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¹Ù„Ù‰ ÙˆØ´Ùƒ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
                const expiringList = document.getElementById('expiringSoonList');
                expiringList.innerHTML = '';
                
                if (expiringSoon.length > 0) {
                    expiringSoon.forEach(student => {
                        const div = document.createElement('div');
                        div.className = 'student-item';
                        div.innerHTML = `
                            <div class="student-header">
                                <div class="student-name">${student.name}</div>
                                <div style="color: #ff9800; font-weight: bold;">${student.daysLeft} ÙŠÙˆÙ…</div>
                            </div>
                            <div class="student-info">
                                <span>${student.class}</span>
                                <span>${student.phone}</span>
                            </div>
                        `;
                        expiringList.appendChild(div);
                    });
                } else {
                    expiringList.innerHTML = '<div style="text-align: center; padding: 20px; color: #b0b0b0;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ø¹Ù„Ù‰ ÙˆØ´Ùƒ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</div>';
                }
                
                showLoading(false);
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error);
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª', 'error');
                showLoading(false);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØµÙ„
        async function loadClassInfo(className) {
            try {
                const q = query(collection(db, COLLECTIONS.CLASS_INFO), where("className", "==", className));
                const querySnapshot = await getDocs(q);
                
                document.getElementById('currentClassInfo').style.display = 'block';
                
                if (!querySnapshot.empty) {
                    const classData = querySnapshot.docs[0].data();
                    document.getElementById('classNews').value = classData.news || '';
                    document.getElementById('classHomework').value = classData.homework || '';
                    
                    if (classData.groupHomework) {
                        document.getElementById('saturdayGroup').value = classData.groupHomework.saturday || '';
                        document.getElementById('tuesdayGroup').value = classData.groupHomework.tuesday || '';
                        document.getElementById('thursdayGroup').value = classData.groupHomework.thursday || '';
                    }
                    
                    // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØµÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                    const classInfoDisplay = document.getElementById('classInfoDisplay');
                    classInfoDisplay.innerHTML = `
                        <div><strong>Ø§Ù„ÙØµÙ„:</strong> ${className}</div>
                        <div><strong>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</strong> ${new Date(classData.updatedAt).toLocaleDateString('ar-EG')}</div>
                    `;
                } else {
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª
                    document.getElementById('classNews').value = '';
                    document.getElementById('classHomework').value = '';
                    document.getElementById('saturdayGroup').value = '';
                    document.getElementById('tuesdayGroup').value = '';
                    document.getElementById('thursdayGroup').value = '';
                    
                    const classInfoDisplay = document.getElementById('classInfoDisplay');
                    classInfoDisplay.innerHTML = `
                        <div><strong>Ø§Ù„ÙØµÙ„:</strong> ${className}</div>
                        <div><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø³Ø¨Ù‚Ø©</div>
                    `;
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØµÙ„:', error);
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØµÙ„', 'error');
            }
        }

        // Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØµÙ„
        document.getElementById('saveClassInfoBtn').addEventListener('click', async () => {
            if (!selectedClassForNews) {
                showMessage('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙØµÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                const classData = {
                    className: selectedClassForNews,
                    news: document.getElementById('classNews').value,
                    homework: document.getElementById('classHomework').value,
                    groupHomework: {
                        saturday: document.getElementById('saturdayGroup').value,
                        tuesday: document.getElementById('tuesdayGroup').value,
                        thursday: document.getElementById('thursdayGroup').value
                    },
                    updatedAt: new Date().toISOString(),
                    updatedBy: 'dashboard'
                };
                
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø³Ø¬Ù„ Ù…ÙˆØ¬ÙˆØ¯
                const q = query(collection(db, COLLECTIONS.CLASS_INFO), where("className", "==", selectedClassForNews));
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯
                    await updateDoc(doc(db, COLLECTIONS.CLASS_INFO, querySnapshot.docs[0].id), classData);
                    showMessage('ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØµÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                } else {
                    // Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯
                    classData.createdAt = new Date().toISOString();
                    await addDoc(collection(db, COLLECTIONS.CLASS_INFO), classData);
                    showMessage('ØªÙ… Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØµÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØµÙ„:', error);
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸', 'error');
            } finally {
                showLoading(false);
            }
        });

        // Ø¨Ø­Ø« Ø¹Ù† Ø·Ø§Ù„Ø¨ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
        document.getElementById('searchStudent').addEventListener('input', async (e) => {
            const searchTerm = e.target.value.trim().toLowerCase();
            
            if (searchTerm.length < 1) {
                document.getElementById('searchResults').innerHTML = '';
                return;
            }
            
            try {
                const studentsSnapshot = await getDocs(collection(db, COLLECTIONS.STUDENTS));
                const results = [];
                
                studentsSnapshot.forEach(doc => {
                    const student = doc.data();
                    const searchFields = [
                        student.name?.toLowerCase(),
                        student.code,
                        student.phone,
                        student.class
                    ];
                    
                    if (searchFields.some(field => field && field.includes(searchTerm))) {
                        results.push({ id: doc.id, ...student });
                    }
                });
                
                displaySearchResults(results);
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«:', error);
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«', 'error');
            }
        });

        function displaySearchResults(results) {
            const container = document.getElementById('searchResults');
            container.innerHTML = '';
            
            if (results.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 30px; color: #b0b0b0;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>';
                return;
            }
            
            results.forEach(student => {
                const endDate = new Date(student.endDate);
                const daysLeft = Math.ceil((endDate - new Date()) / (1000 * 60 * 60 * 24));
                
                const div = document.createElement('div');
                div.className = 'student-item';
                div.innerHTML = `
                    <div class="student-header">
                        <div class="student-name">${student.name}</div>
                        <div class="student-code">${student.code}</div>
                    </div>
                    <div class="student-info">
                        <span>${student.class}</span>
                        <span>${student.phone}</span>
                        <span>${daysLeft} ÙŠÙˆÙ… Ù…ØªØ¨Ù‚ÙŠ</span>
                    </div>
                `;
                
                div.addEventListener('click', () => {
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ±
                    document.querySelectorAll('#searchResults .student-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù„Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø­Ø§Ù„ÙŠ
                    div.classList.add('selected');
                    // ØªØ­Ø±ÙŠØ± Ø§Ù„Ø·Ø§Ù„Ø¨
                    editStudent(student.id, student);
                });
                
                container.appendChild(div);
            });
        }

        // ØªØ­Ø±ÙŠØ± Ø§Ù„Ø·Ø§Ù„Ø¨
        async function editStudent(studentId, studentData) {
            showLoading(true);
            currentEditingStudent = studentId;
            currentStudentData = studentData;
            
            try {
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
                const q = query(collection(db, COLLECTIONS.STUDENT_DATA), where("studentId", "==", studentId));
                const querySnapshot = await getDocs(q);
                
                document.getElementById('editingStudentName').textContent = `ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª: ${studentData.name}`;
                
                const endDate = new Date(studentData.endDate);
                const daysLeft = Math.ceil((endDate - new Date()) / (1000 * 60 * 60 * 24));
                
                document.getElementById('editingStudentInfo').innerHTML = `
                    <span>Ø§Ù„ÙØµÙ„: ${studentData.class}</span>
                    <span>Ø§Ù„ÙƒÙˆØ¯: ${studentData.code}</span>
                    <span>${daysLeft} ÙŠÙˆÙ… Ù…ØªØ¨Ù‚ÙŠ</span>
                `;
                
                if (!querySnapshot.empty) {
                    const studentInfo = querySnapshot.docs[0].data();
                    
                    document.getElementById('studentLevel').value = studentInfo.level || '';
                    document.getElementById('studentBehavior').value = studentInfo.behavior || '';
                    document.getElementById('studentHomeworkStatus').value = studentInfo.homeworkStatus || '';
                    
                    // Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
                    const gradesList = document.getElementById('gradesList');
                    gradesList.innerHTML = '';
                    
                    if (studentInfo.grades && studentInfo.grades.length > 0) {
                        studentInfo.grades.forEach((grade, index) => {
                            const gradeDiv = document.createElement('div');
                            gradeDiv.className = 'grade-item';
                            gradeDiv.innerHTML = `
                                <div>
                                    <strong>${grade.title}</strong><br>
                                    <small>${grade.value} / 100</small>
                                </div>
                                <button class="btn btn-small btn-danger delete-grade" data-index="${index}">Ø­Ø°Ù</button>
                            `;
                            gradesList.appendChild(gradeDiv);
                        });
                        
                        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù
                        document.querySelectorAll('.delete-grade').forEach(btn => {
                            btn.addEventListener('click', async (e) => {
                                e.stopPropagation();
                                const index = parseInt(btn.dataset.index);
                                await deleteGrade(studentId, index);
                            });
                        });
                    }
                }
                
                document.getElementById('studentEditForm').style.display = 'block';
                showLoading(false);
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨:', error);
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨', 'error');
                showLoading(false);
            }
        }

        // Ø­Ø°Ù Ø¯Ø±Ø¬Ø©
        async function deleteGrade(studentId, gradeIndex) {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø±Ø¬Ø©ØŸ')) return;
            
            try {
                const q = query(collection(db, COLLECTIONS.STUDENT_DATA), where("studentId", "==", studentId));
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    const docId = querySnapshot.docs[0].id;
                    const studentInfo = querySnapshot.docs[0].data();
                    
                    const updatedGrades = [...(studentInfo.grades || [])];
                    updatedGrades.splice(gradeIndex, 1);
                    
                    await updateDoc(doc(db, COLLECTIONS.STUDENT_DATA, docId), {
                        grades: updatedGrades,
                        updatedAt: new Date().toISOString()
                    });
                    
                    showMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯Ø±Ø¬Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
                    editStudent(studentId, currentStudentData);
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¯Ø±Ø¬Ø©:', error);
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¯Ø±Ø¬Ø©', 'error');
            }
        }

        // Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø¬Ø© Ù„Ù„Ø·Ø§Ù„Ø¨
        document.getElementById('addGradeBtn').addEventListener('click', async () => {
            const title = document.getElementById('gradeTitle').value;
            const value = parseInt(document.getElementById('gradeValue').value);
            
            if (!title || !value || value < 0 || value > 100) {
                showMessage('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† ØµØ­ÙŠØ­ ÙˆÙ‚ÙŠÙ…Ø© Ø¨ÙŠÙ† 0 Ùˆ 100', 'error');
                return;
            }
            
            try {
                const q = query(collection(db, COLLECTIONS.STUDENT_DATA), where("studentId", "==", currentEditingStudent));
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    const docId = querySnapshot.docs[0].id;
                    const studentInfo = querySnapshot.docs[0].data();
                    
                    const updatedGrades = [...(studentInfo.grades || []), { title, value }];
                    
                    await updateDoc(doc(db, COLLECTIONS.STUDENT_DATA, docId), {
                        grades: updatedGrades,
                        updatedAt: new Date().toISOString()
                    });
                    
                    showMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø±Ø¬Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
                    document.getElementById('gradeTitle').value = '';
                    document.getElementById('gradeValue').value = '';
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
                    editStudent(currentEditingStudent, currentStudentData);
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø±Ø¬Ø©:', error);
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø±Ø¬Ø©', 'error');
            }
        });

        // Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
        document.getElementById('saveStudentInfoBtn').addEventListener('click', async () => {
            if (!currentEditingStudent) {
                showMessage('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø§Ù„Ø¨ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                const q = query(collection(db, COLLECTIONS.STUDENT_DATA), where("studentId", "==", currentEditingStudent));
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    const docId = querySnapshot.docs[0].id;
                    
                    await updateDoc(doc(db, COLLECTIONS.STUDENT_DATA, docId), {
                        level: document.getElementById('studentLevel').value,
                        behavior: document.getElementById('studentBehavior').value,
                        homeworkStatus: document.getElementById('studentHomeworkStatus').value,
                        updatedAt: new Date().toISOString(),
                        updatedBy: 'dashboard'
                    });
                    
                    showMessage('ØªÙ… Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                } else {
                    // Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                    const studentInfoData = {
                        studentId: currentEditingStudent,
                        studentName: currentStudentData.name,
                        studentPhone: currentStudentData.phone,
                        studentClass: currentStudentData.class,
                        level: document.getElementById('studentLevel').value,
                        behavior: document.getElementById('studentBehavior').value,
                        homeworkStatus: document.getElementById('studentHomeworkStatus').value,
                        grades: [],
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString(),
                        updatedBy: 'dashboard'
                    };
                    
                    await addDoc(collection(db, COLLECTIONS.STUDENT_DATA), studentInfoData);
                    showMessage('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨:', error);
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸', 'error');
            } finally {
                showLoading(false);
            }
        });

        // Ø­Ø°Ù Ø·Ø§Ù„Ø¨
        document.getElementById('deleteStudentBtn').addEventListener('click', async () => {
            if (!currentEditingStudent) {
                showMessage('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø§Ù„Ø¨ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }
            
            if (!confirm('âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø³ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù… ÙˆÙ„Ù† ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.')) {
                return;
            }
            
            showLoading(true);
            
            try {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ù†ØªÙ‡ÙŠ Ø£ÙˆÙ„Ø§Ù‹
                const endDate = new Date(currentStudentData.endDate);
                const daysLeft = Math.ceil((endDate - new Date()) / (1000 * 60 * 60 * 24));
                
                if (daysLeft > 0 && currentStudentData.active) {
                    if (!confirm(`âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù„Ø§ ÙŠØ²Ø§Ù„ Ø§Ø´ØªØ±Ø§ÙƒÙ‡ ÙØ¹Ø§Ù„Ø§Ù‹ (Ù…ØªØ¨Ù‚ÙŠ ${daysLeft} ÙŠÙˆÙ…).\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ø±ØºÙ… Ø°Ù„ÙƒØŸ`)) {
                        showLoading(false);
                        return;
                    }
                }
                
                // Ø­Ø°Ù Ù…Ù† students collection
                await deleteDoc(doc(db, COLLECTIONS.STUDENTS, currentEditingStudent));
                
                // Ø­Ø°Ù Ù…Ù† student_data collection
                const q = query(collection(db, COLLECTIONS.STUDENT_DATA), where("studentId", "==", currentEditingStudent));
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    await deleteDoc(doc(db, COLLECTIONS.STUDENT_DATA, querySnapshot.docs[0].id));
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ active_subscriptions Ù„ÙŠÙƒÙˆÙ† ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…
                const codeQuery = query(collection(db, COLLECTIONS.ACTIVE_SUBSCRIPTIONS), where("code", "==", currentStudentData.code));
                const codeSnapshot = await getDocs(codeQuery);
                
                if (!codeSnapshot.empty) {
                    await updateDoc(doc(db, COLLECTIONS.ACTIVE_SUBSCRIPTIONS, codeSnapshot.docs[0].id), {
                        used: false,
                        studentName: null,
                        studentPhone: null,
                        studentClass: null,
                        deletedAt: new Date().toISOString()
                    });
                }
                
                showMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                document.getElementById('studentEditForm').style.display = 'none';
                document.getElementById('searchStudent').value = '';
                document.getElementById('searchResults').innerHTML = '';
                currentEditingStudent = null;
                currentStudentData = null;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
                await loadStudents();
                await loadStatistics();
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨:', error);
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨', 'error');
            } finally {
                showLoading(false);
            }
        });

        // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ø´ØªØ±Ø§ÙƒØ§ØªÙ‡Ù…
        document.getElementById('deactivateExpiredBtn').addEventListener('click', async () => {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ¹Ø·ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ø´ØªØ±Ø§ÙƒØ§ØªÙ‡Ù…ØŸ\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø³ÙŠÙ…Ù†Ø¹Ù‡Ù… Ù…Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù… ÙˆÙ„ÙƒÙ† ÙŠØ­ØªÙØ¸ Ø¨Ø¨ÙŠØ§Ù†Ø§ØªÙ‡Ù….')) {
                return;
            }
            
            showLoading(true);
            
            try {
                const studentsSnapshot = await getDocs(collection(db, COLLECTIONS.STUDENTS));
                const today = new Date();
                let deactivatedCount = 0;
                
                for (const docSnap of studentsSnapshot.docs) {
                    const student = docSnap.data();
                    const endDate = new Date(student.endDate);
                    
                    if (endDate < today && student.active) {
                        await updateDoc(doc(db, COLLECTIONS.STUDENTS, docSnap.id), {
                            active: false,
                            deactivatedAt: new Date().toISOString()
                        });
                        deactivatedCount++;
                    }
                }
                
                showMessage(`ØªÙ… ØªØ¹Ø·ÙŠÙ„ ${deactivatedCount} Ø·Ø§Ù„Ø¨ Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ`, 'success');
                await loadStudents();
                await loadStatistics();
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨:', error);
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ø·ÙŠÙ„', 'error');
            } finally {
                showLoading(false);
            }
        });

        // Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ø´ØªØ±Ø§ÙƒØ§ØªÙ‡Ù… Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹
        document.getElementById('deleteExpiredBtn').addEventListener('click', async () => {
            if (!confirm('âš ï¸ ØªØ­Ø°ÙŠØ± Ø´Ø¯ÙŠØ¯: Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ø´ØªØ±Ø§ÙƒØ§ØªÙ‡Ù… Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡ ÙˆØ³ÙŠØ­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ø´ØªØ±Ø§ÙƒØ§ØªÙ‡Ù… Ø¨Ø´ÙƒÙ„ Ù†Ù‡Ø§Ø¦ÙŠ.')) {
                return;
            }
            
            showLoading(true);
            
            try {
                const studentsSnapshot = await getDocs(collection(db, COLLECTIONS.STUDENTS));
                const today = new Date();
                let deletedCount = 0;
                
                for (const docSnap of studentsSnapshot.docs) {
                    const student = docSnap.data();
                    const endDate = new Date(student.endDate);
                    
                    // Ø­Ø°Ù ÙÙ‚Ø· Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ø´ØªØ±Ø§ÙƒØ§ØªÙ‡Ù… ÙˆØºÙŠØ± Ù†Ø´Ø·ÙŠÙ†
                    if (endDate < today) {
                        await deleteDoc(doc(db, COLLECTIONS.STUDENTS, docSnap.id));
                        
                        // Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
                        const q = query(collection(db, COLLECTIONS.STUDENT_DATA), where("studentId", "==", docSnap.id));
                        const querySnapshot = await getDocs(q);
                        
                        if (!querySnapshot.empty) {
                            await deleteDoc(doc(db, COLLECTIONS.STUDENT_DATA, querySnapshot.docs[0].id));
                        }
                        
                        deletedCount++;
                    }
                }
                
                showMessage(`ØªÙ… Ø­Ø°Ù ${deletedCount} Ø·Ø§Ù„Ø¨ Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ`, 'success');
                await loadStudents();
                await loadStatistics();
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø§Ø¨:', error);
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù', 'error');
            } finally {
                showLoading(false);
            }
        });

        // ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        document.getElementById('exportDataBtn').addEventListener('click', async () => {
            showLoading(true);
            
            try {
                const [studentsSnapshot, classInfoSnapshot, studentDataSnapshot] = await Promise.all([
                    getDocs(collection(db, COLLECTIONS.STUDENTS)),
                    getDocs(collection(db, COLLECTIONS.CLASS_INFO)),
                    getDocs(collection(db, COLLECTIONS.STUDENT_DATA))
                ]);
                
                const data = {
                    students: [],
                    classInfo: [],
                    studentData: [],
                    exportDate: new Date().toISOString(),
                    system: "Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠØ©"
                };
                
                studentsSnapshot.forEach(doc => {
                    data.students.push({ id: doc.id, ...doc.data() });
                });
                
                classInfoSnapshot.forEach(doc => {
                    data.classInfo.push({ id: doc.id, ...doc.data() });
                });
                
                studentDataSnapshot.forEach(doc => {
                    data.studentData.push({ id: doc.id, ...doc.data() });
                });
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù JSON Ù„Ù„ØªØ­Ù…ÙŠÙ„
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `students_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showMessage('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±', 'error');
            } finally {
                showLoading(false);
            }
        });

        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
        function showMessage(text, type) {
            message.textContent = text;
            message.className = `message ${type}`;
            message.style.display = 'block';
            
            setTimeout(() => {
                message.style.display = 'none';
            }, 5000);
        }
        
        function showLoading(show) {
            loading.style.display = show ? 'block' : 'none';
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
        loadStudents();
        
        // Ù…Ù†Ø¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ØºÙŠØ± Ø§Ù„Ø±Ù‚Ù…ÙŠ
        document.getElementById('studentPhone').addEventListener('input', function() {
            this.value = this.value.replace(/[^0-9]/g, '');
        });
        
        document.getElementById('gradeValue').addEventListener('input', function() {
            this.value = this.value.replace(/[^0-9]/g, '');
            if (this.value > 100) this.value = 100;
        });

        console.log('Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…');
    </script>
</body>
</html>